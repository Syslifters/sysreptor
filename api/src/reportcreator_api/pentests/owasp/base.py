import re
from django.db import models
from django.utils.translation import gettext_lazy as _


OWASP_REGEX = re.compile(r'^OWASP:(/[A-Za-z]+:[A-Za-z]+)+$')

OWASP_METRICS = {
    'LF': {'N': 0, 'L': 1, 'M': 2, 'H': 3, 'C': 4},
    'IF': {'N': 0, 'L': 1, 'M': 2, 'H': 3, 'C': 4},
    'ORS': {'N': 0, 'L': 1, 'M': 2, 'H': 3, 'C': 4}
}

class OWASPLevel(models.TextChoices):
    NOTE = 'note', _('Note')
    LOW = 'low', _('Low')
    MEDIUM = 'medium', _('Medium')
    HIGH = 'high', _('High')
    CRITICAL = 'critical', _('Critical')

def level_from_score(score: int) -> OWASPLevel:
    match score:
        case 4:
            return OWASPLevel.CRITICAL
        case 3:
            return OWASPLevel.HIGH
        case 2:
            return OWASPLevel.MEDIUM
        case 1:
            return OWASPLevel.LOW
        case 0:
            return OWASPLevel.NOTE
        case _:
            return OWASPLevel.NOTE
    # if score >= 9.0:
    #     return CVSSLevel.CRITICAL
    # elif score >= 7.0:
    #     return CVSSLevel.HIGH
    # elif score >= 4.0:
    #     return CVSSLevel.MEDIUM
    # elif score > 0:
    #     return CVSSLevel.LOW
    # else:
    #     return CVSSLevel.INFO